import{j as e,r as m,c as S,R as D}from"./client-DD4c7S6m.js";function C(t){var s,n,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(s=0;s<o;s++)t[s]&&(n=C(t[s]))&&(a&&(a+=" "),a+=n)}else for(n in t)t[n]&&(a&&(a+=" "),a+=n);return a}function w(){for(var t,s,n=0,a="",o=arguments.length;n<o;n++)(t=arguments[n])&&(s=C(t))&&(a&&(a+=" "),a+=s);return a}const q={solid:{black:"bg-black text-white hover:bg-gray-700",white:"bg-white text-blue-600 hover:bg-blue-100",blue:"bg-blue-500 text-white hover:bg-blue-600",red:"bg-red-500 text-white hover:bg-red-60",gray:"bg-gray-300 text-gray-800 hover:bg-gray-400",green:"bg-green-500 text-white hover:bg-green-600"},ghost:{black:"outline outline-black text-white",white:"outline outline-white text-white",blue:"outline outline-blue-500 text-blue-500",red:"outline outline-red-500 text-red-500",gray:"outline outline-gray-300 text-gray-300",green:"outline outline-green-500 text-green-500"},text:{black:"text-black",white:"text-white",blue:"text-blue-500",red:"text-red-500",gray:"text-gray-300",green:"text-green-500"}},b=({children:t,className:s,variant:n="solid",color:a="blue",...o})=>{const c=w(s,q[n][a],"rounded disabled:cursor-not-allowed disabled:bg-gray-300 disabled:text-gray-500");return e.jsx("button",{className:c,...o,children:t})},k=({name:t,options:s,className:n,...a})=>{const o=w(n,"border rounded");return e.jsx("select",{className:o,...a,children:s.map(({key:c,value:r,content:l,...i})=>e.jsx("option",{value:r,...i,children:l},c))})},A=({product:t,onProductUpdate:s,onCompleteEdit:n})=>{const[a,o]=m.useState(t),[c,r]=m.useState({quantity:0,rate:0}),l=x=>{const{name:h,value:d,type:j}=x.target;o(N=>({...N,[h]:j==="number"?parseInt(d):d}))},i=x=>{const{name:h,value:d}=x.target,j=parseInt(d);r(N=>({...N,[h]:h==="rate"?j/100:j}))},u=()=>{n(a)},p=()=>{const x={...t,discounts:[...t.discounts,c]};s(x),o(x),r({quantity:0,rate:0})},g=x=>{const h={...t,discounts:t.discounts.filter((d,j)=>j!==x)};s(h),o(h)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",name:"price",value:a.price,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",name:"stock",value:a.stock,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),a.discounts.map((x,h)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[x.quantity,"개 이상 구매 시 ",x.rate*100,"% 할인"]}),e.jsx(b,{className:"px-2 py-1",variant:"solid",color:"red",onClick:()=>g(h),children:"삭제"})]},h)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",name:"quantity",placeholder:"수량",value:c.quantity,onChange:i,className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",name:"rate",placeholder:"할인율 (%)",value:c.rate*100,onChange:i,className:"w-1/3 p-2 border rounded"}),e.jsx(b,{className:"w-1/3 p-2",variant:"solid",color:"blue",onClick:p,children:"할인 추가"})]})]}),e.jsx(b,{className:"px-2 py-1 mt-2",variant:"solid",color:"green",onClick:u,children:"수정 완료"})]})},E=t=>Object.values(t).some(s=>typeof s=="string"?s==="":typeof s=="number"?s===0:Array.isArray(s)?s.length===0:s==null),P=(t,s)=>{const n=E(t);return n&&alert(s),n},y={name:"",price:0,stock:0},I=({onAddNewProduct:t})=>{const[s,n]=m.useState(y),a=c=>{const{name:r,value:l,type:i}=c.target;n(u=>({...u,[r]:i==="number"?parseInt(l):l}))},o=()=>{if(P(s,"새 상품 정보를 입력해주세요."))return;const c={...s,id:Date.now().toString(),discounts:[]};t(c),n(y)};return e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",name:"name",value:s.name,onChange:a,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",name:"price",value:s.price,onChange:a,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",name:"stock",value:s.stock,onChange:a,className:"w-full p-2 border rounded"})]}),e.jsx(b,{className:"w-full p-2",variant:"solid",color:"blue",onClick:o,children:"추가"})]})},F=({product:t,onProductEdit:s})=>{const{id:n,discounts:a}=t,o=()=>{s(n)};return e.jsxs("div",{children:[a.map((c,r)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[c.quantity,"개 이상 구매 시 ",c.rate*100,"% 할인"]})},r)),e.jsx(b,{className:"px-2 py-1 mt-2",variant:"solid",color:"blue","data-testid":"modify-button",onClick:o,children:"수정"})]})},T=({product:t,index:s,isOpen:n,isEditing:a,onProductUpdate:o,onProductEdit:c,onCompleteEdit:r,onToggleButtonClick:l})=>{const{id:i,name:u,price:p,stock:g}=t,x=()=>{l(i)};return e.jsxs("div",{"data-testid":`product-${s+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs(b,{className:"w-full text-left font-semibold",variant:"text",color:"black","data-testid":"toggle-button",onClick:x,children:[u," - ",p,"원 (재고: ",g,")"]}),n&&e.jsx("div",{className:"mt-2",children:a?e.jsx(A,{product:t,onProductUpdate:o,onCompleteEdit:r}):e.jsx(F,{product:t,onProductEdit:c})})]})},$=(t,s)=>t.find(a=>a.product.id===s.id)?t.map(a=>a.product.id===s.id?{...a,quantity:Math.min(a.quantity+1,s.stock)}:a):[...t,{product:s,quantity:1}],M=t=>{const{discounts:s}=t.product,{quantity:n}=t;let a=0;for(const o of s)n>=o.quantity&&(a=Math.max(a,o.rate));return a},V=t=>{const{discounts:s}=t.product,{quantity:n}=t;let a=0;for(const o of s)n>=o.quantity&&(a=Math.max(a,o.rate));return a},R=t=>t.reduce((s,n)=>Math.max(s,n.rate),0),O=t=>{const{price:s}=t.product,{quantity:n}=t,a=s*n,o=V(t);return a*(1-o)},L=(t,s)=>{let n=t;if(s){const{discountType:a,discountValue:o}=s;a==="amount"?n-=o:n-=+(1-(100-o)/100).toFixed(2)*n}return n},Q=(t,s)=>{const n=t.reduce((c,{product:r,quantity:l})=>c+r.price*l,0),a=t.reduce((c,r)=>c+O(r),0),o=L(a,s);return{totalBeforeDiscount:n,totalAfterDiscount:o,totalDiscount:n-o}},B=(t,s,n)=>t.map(a=>{if(a.product.id===s){const o=a.product.stock,c=Math.max(0,Math.min(n,o));return c>0?{...a,quantity:c}:null}return a}).filter(a=>a!==null),J=({remainingStock:t,product:s,children:n})=>{const{id:a,name:o,price:c,discounts:r}=s;return e.jsxs("div",{"data-testid":`product-${a}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:o}),e.jsxs("span",{className:"text-gray-600",children:[c.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${t>0?"text-green-600":"text-red-600"}`,children:["재고: ",t,"개"]}),r.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(R(r)*100).toFixed(0),"% 할인"]})]}),r.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:r.map((l,i)=>e.jsxs("li",{children:[l.quantity,"개 이상: ",(l.rate*100).toFixed(0),"% 할인"]},i))}),n]})},W=({products:t,onProductAdd:s,onProductUpdate:n})=>{const[a,o]=m.useState(new Set),[c,r]=m.useState(""),[l,i]=m.useState(!1),u=d=>{o(j=>{const N=new Set(j);return N.has(d)?N.delete(d):N.add(d),N})},p=d=>{n(d),r("")},g=d=>{r(d)},x=d=>{s(d),h()},h=()=>{i(d=>!d)};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(b,{className:"px-4 py-2 mb-4",variant:"solid",color:"green",onClick:h,children:l?"취소":"새 상품 추가"}),l&&e.jsx(I,{onAddNewProduct:x}),e.jsx("div",{className:"space-y-2",children:t.map((d,j)=>e.jsx(T,{product:d,index:j,isOpen:a.has(d.id),isEditing:c===d.id,onProductEdit:g,onCompleteEdit:p,onProductUpdate:n,onToggleButtonClick:u},`product-${d.id}-accordion`))})]})},_=({coupons:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(({name:s,code:n,discountType:a,discountValue:o},c)=>e.jsxs("div",{"data-testid":`coupon-${c+1}`,className:"bg-gray-100 p-2 rounded",children:[s," (",n,"):",a==="amount"?`${o}원`:`${o}%`," ","할인"]},`coupon-${n}`))})]}),z=({coupons:t,onCouponAdd:s})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(U,{onCouponAdd:s}),e.jsx(_,{coupons:t})]})]}),G=t=>{const s=t.map(({code:n,name:a,discountType:o,discountValue:c},r)=>({key:n,value:`${r}`,content:`${a} - ${c}${o==="amount"?"원":"%"}`}));return s.unshift({key:"coupon-default",value:"",content:"쿠폰 선택"}),s},H=({coupons:t,applyCoupon:s,selectedCoupon:n})=>{const a=o=>{const c=o.target.value;s(t[parseInt(c)])};return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsx(k,{name:"coupon",options:G(t),onChange:a,className:"w-full p-2 border rounded mb-2"}),n&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",n.name,"(",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`," ","할인)"]})]})},f={name:"",code:"",discountType:"percentage",discountValue:0},K=[{key:"coupon-amount",value:"amount",content:"금액(원)"},{key:"coupon-percentage",value:"percentage",content:"할인율(%)"}],U=({onCouponAdd:t})=>{const[s,n]=m.useState(f),a=()=>{P(s,"새 쿠폰 정보를 입력해주세요.")||(t(s),n(f))},o=c=>{const{name:r,value:l,type:i}=c.target;n(u=>({...u,[r]:i==="number"?parseInt(l):l}))};return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",name:"name",value:s.name,onChange:o,className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",name:"code",value:s.code,onChange:o,className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{name:"discountType",onChange:o,className:"w-full p-2",options:K}),e.jsx("input",{type:"number",placeholder:"할인 값",name:"discountValue",value:s.discountValue,onChange:o,className:"w-full p-2 border rounded"})]}),e.jsx(b,{className:"w-full p-2",variant:"solid",color:"green",onClick:a,children:"쿠폰 추가"})]})},X=({products:t,coupons:s,onProductUpdate:n,onProductAdd:a,onCouponAdd:o})=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(W,{products:t,onProductAdd:a,onProductUpdate:n}),e.jsx(z,{coupons:s,onCouponAdd:o})]})]}),Y=({item:t,updateQuantity:s,removeFromCart:n})=>{const{product:a,quantity:o}=t,{id:c,name:r,price:l}=a,i=M(t),u=g=>{const h=g.target.dataset.change;h&&s(c,o+Number(h))},p=()=>{n(c)};return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:r}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[l,"원 x ",o,i>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(i*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx(b,{className:"px-2 py-1 mr-1",variant:"solid",color:"gray","data-change":"-1",onClick:u,children:"-"}),e.jsx(b,{className:"px-2 py-1 mr-1",variant:"solid",color:"gray","data-change":"1",onClick:u,children:"+"}),e.jsx(b,{className:"px-2 py-1",variant:"solid",color:"red",onClick:p,children:"삭제"})]})]},t.product.id)},Z=({product:t,remainingStock:s,addToCart:n})=>{const a=()=>{n(t)};return e.jsx(J,{product:t,remainingStock:s,children:e.jsx(b,{className:"w-full px-3 py-1",variant:"solid",color:"blue",onClick:a,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})})},ee=({cart:t,products:s,addToCart:n})=>{const a=(o,c)=>{const r=o.find(l=>l.product.id===c.id);return c.stock-((r==null?void 0:r.quantity)||0)};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:s.map(o=>{const c=a(t,o);return e.jsx(Z,{remainingStock:c,product:o,addToCart:n},`cart-item-card-${o.id}`)})})]})},te=({cart:t,coupons:s,applyCoupon:n,calculateTotal:a,updateQuantity:o,removeFromCart:c,selectedCoupon:r})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:t.map(l=>e.jsx(Y,{item:l,updateQuantity:o,removeFromCart:c},`cart-item-card-${l.product.id}`))}),e.jsx(H,{coupons:s,applyCoupon:n,selectedCoupon:r}),e.jsx(se,{calculateTotal:a})]}),se=({calculateTotal:t})=>{const{totalBeforeDiscount:s,totalAfterDiscount:n,totalDiscount:a}=t();return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",a.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",n.toLocaleString(),"원"]})]})]})},ne=(t,s)=>{const n=localStorage.getItem(t);return n?JSON.parse(n):s},v=(t,s)=>{const[n,a]=m.useState(()=>ne(t,s));return m.useEffect(()=>{localStorage.setItem(t,JSON.stringify(n))},[t,n]),[n,a]},ae=()=>{const[t,s]=v("cart",[]),[n,a]=v("coupon",null),o=m.useCallback(u=>{s(p=>$(p,u))},[]),c=m.useCallback(u=>{s(p=>p.filter(g=>g.product.id!==u))},[]),r=m.useCallback((u,p)=>{s(g=>B(g,u,p))},[]),l=m.useCallback(u=>{a(u)},[]),i=m.useCallback(()=>Q(t,n),[t,n]);return{cart:t,addToCart:o,removeFromCart:c,updateQuantity:r,applyCoupon:l,calculateTotal:i,selectedCoupon:n}},oe=t=>{const[s,n]=m.useState(t),a=m.useCallback(o=>{n(c=>[...c,o])},[]);return{coupons:s,addCoupon:a}},ce=t=>{const[s,n]=m.useState(t),a=m.useCallback(c=>{n(r=>[...r,c])},[]),o=m.useCallback(c=>{n(r=>r.map(l=>l.id===c.id?c:l))},[]);return{products:s,updateProduct:o,addProduct:a}},re=({products:t,coupons:s})=>{const{cart:n,addToCart:a,removeFromCart:o,updateQuantity:c,applyCoupon:r,calculateTotal:l,selectedCoupon:i}=ae();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(ee,{cart:n,products:t,addToCart:a}),e.jsx(te,{cart:n,coupons:s,removeFromCart:o,updateQuantity:c,applyCoupon:r,calculateTotal:l,selectedCoupon:i})]})]})},le=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],ie=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],de=()=>{const{products:t,updateProduct:s,addProduct:n}=ce(ie),{coupons:a,addCoupon:o}=oe(le),[c,r]=m.useState(!1),l=()=>{r(i=>!i)};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx(b,{className:"px-4 py-2",variant:"solid",color:"white",onClick:l,children:c?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:c?e.jsx(X,{products:t,coupons:a,onProductUpdate:s,onProductAdd:n,onCouponAdd:o}):e.jsx(re,{products:t,coupons:a})})]})};S.createRoot(document.getElementById("root")).render(e.jsx(D.StrictMode,{children:e.jsx(de,{})}));
