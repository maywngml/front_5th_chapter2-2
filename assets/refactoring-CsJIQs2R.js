import{j as e,r as h,c as q,R as A}from"./client-DD4c7S6m.js";const E=({coupons:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(({name:s,code:n,discountType:a,discountValue:o},c)=>e.jsxs("div",{"data-testid":`coupon-${c+1}`,className:"bg-gray-100 p-2 rounded",children:[s," (",n,"):",a==="amount"?`${o}원`:`${o}%`," ","할인"]},`coupon-${n}`))})]});function k(t){var s,n,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(s=0;s<o;s++)t[s]&&(n=k(t[s]))&&(a&&(a+=" "),a+=n)}else for(n in t)t[n]&&(a&&(a+=" "),a+=n);return a}function P(){for(var t,s,n=0,a="",o=arguments.length;n<o;n++)(t=arguments[n])&&(s=k(t))&&(a&&(a+=" "),a+=s);return a}const I={solid:{black:"bg-black text-white hover:bg-gray-700",white:"bg-white text-blue-600 hover:bg-blue-100",blue:"bg-blue-500 text-white hover:bg-blue-600",red:"bg-red-500 text-white hover:bg-red-60",gray:"bg-gray-300 text-gray-800 hover:bg-gray-400",green:"bg-green-500 text-white hover:bg-green-600"},ghost:{black:"outline outline-black text-white",white:"outline outline-white text-white",blue:"outline outline-blue-500 text-blue-500",red:"outline outline-red-500 text-red-500",gray:"outline outline-gray-300 text-gray-300",green:"outline outline-green-500 text-green-500"},text:{black:"text-black",white:"text-white",blue:"text-blue-500",red:"text-red-500",gray:"text-gray-300",green:"text-green-500"}},g=({children:t,className:s,variant:n="solid",color:a="blue",...o})=>{const c=P(s,I[n][a],"rounded disabled:cursor-not-allowed disabled:bg-gray-300 disabled:text-gray-500");return e.jsx("button",{className:c,...o,children:t})},S=({name:t,options:s,className:n,...a})=>{const o=P(n,"border rounded");return e.jsx("select",{className:o,...a,children:s.map(({key:c,value:r,content:l,...i})=>e.jsx("option",{value:r,...i,children:l},c))})},F=t=>{const s=t.map(({code:n,name:a,discountType:o,discountValue:c},r)=>({key:n,value:`${r}`,content:`${a} - ${c}${o==="amount"?"원":"%"}`}));return s.unshift({key:"coupon-default",value:"",content:"쿠폰 선택"}),s},T=({coupons:t,applyCoupon:s,selectedCoupon:n})=>{const a=o=>{const c=o.target.value;s(t[parseInt(c)])};return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsx(S,{name:"coupon",options:F(t),onChange:a,className:"w-full p-2 border rounded mb-2"}),n&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",n.name,"(",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`," ","할인)"]})]})},$=t=>Object.values(t).some(s=>typeof s=="string"?s==="":typeof s=="number"?s===0:Array.isArray(s)?s.length===0:s==null),D=(t,s)=>{const n=$(t);return n&&alert(s),n},v={name:"",code:"",discountType:"percentage",discountValue:0},V=[{key:"coupon-amount",value:"amount",content:"금액(원)"},{key:"coupon-percentage",value:"percentage",content:"할인율(%)"}],M=({onCouponAdd:t})=>{const[s,n]=h.useState(v),a=()=>{D(s,"새 쿠폰 정보를 입력해주세요.")||(t(s),n(v))},o=c=>{const{name:r,value:l,type:i}=c.target;n(d=>({...d,[r]:i==="number"?parseInt(l):l}))};return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",name:"name",value:s.name,onChange:o,className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",name:"code",value:s.code,onChange:o,className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{name:"discountType",onChange:o,className:"w-full p-2",options:V}),e.jsx("input",{type:"number",placeholder:"할인 값",name:"discountValue",value:s.discountValue,onChange:o,className:"w-full p-2 border rounded"})]}),e.jsx(g,{className:"w-full p-2",variant:"solid",color:"green",onClick:a,children:"쿠폰 추가"})]})},R=({product:t,onProductUpdate:s,onCompleteEdit:n})=>{const[a,o]=h.useState(t),[c,r]=h.useState({quantity:0,rate:0}),l=m=>{const{name:p,value:N,type:j}=m.target;o(x=>({...x,[p]:j==="number"?parseInt(N):N}))},i=m=>{const{name:p,value:N}=m.target,j=parseInt(N);r(x=>({...x,[p]:p==="rate"?j/100:j}))},d=()=>{n(a)},u=()=>{const m={...t,discounts:[...t.discounts,c]};s(m),o(m),r({quantity:0,rate:0})},b=m=>{const p={...t,discounts:t.discounts.filter((N,j)=>j!==m)};s(p),o(p)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",name:"price",value:a.price,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",name:"stock",value:a.stock,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),a.discounts.map((m,p)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[m.quantity,"개 이상 구매 시 ",m.rate*100,"% 할인"]}),e.jsx(g,{className:"px-2 py-1",variant:"solid",color:"red",onClick:()=>b(p),children:"삭제"})]},p)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",name:"quantity",placeholder:"수량",value:c.quantity,onChange:i,className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",name:"rate",placeholder:"할인율 (%)",value:c.rate*100,onChange:i,className:"w-1/3 p-2 border rounded"}),e.jsx(g,{className:"w-1/3 p-2",variant:"solid",color:"blue",onClick:u,children:"할인 추가"})]})]}),e.jsx(g,{className:"px-2 py-1 mt-2",variant:"solid",color:"green",onClick:d,children:"수정 완료"})]})},C={name:"",price:0,stock:0},O=({onAddNewProduct:t})=>{const[s,n]=h.useState(C),a=c=>{const{name:r,value:l,type:i}=c.target;n(d=>({...d,[r]:i==="number"?parseInt(l):l}))},o=()=>{if(D(s,"새 상품 정보를 입력해주세요."))return;const c={...s,id:Date.now().toString(),discounts:[]};t(c),n(C)};return e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",name:"name",value:s.name,onChange:a,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",name:"price",value:s.price,onChange:a,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",name:"stock",value:s.stock,onChange:a,className:"w-full p-2 border rounded"})]}),e.jsx(g,{className:"w-full p-2",variant:"solid",color:"blue",onClick:o,children:"추가"})]})},L=({product:t,onProductEdit:s})=>{const{id:n,discounts:a}=t,o=()=>{s(n)};return e.jsxs("div",{children:[a.map((c,r)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[c.quantity,"개 이상 구매 시 ",c.rate*100,"% 할인"]})},r)),e.jsx(g,{className:"px-2 py-1 mt-2",variant:"solid",color:"blue","data-testid":"modify-button",onClick:o,children:"수정"})]})},Q=({product:t,index:s,isOpen:n,isEditing:a,onProductUpdate:o,onProductEdit:c,onCompleteEdit:r,onToggleButtonClick:l})=>{const{id:i,name:d,price:u,stock:b}=t,m=()=>{l(i)};return e.jsxs("div",{"data-testid":`product-${s+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs(g,{className:"w-full text-left font-semibold",variant:"text",color:"black","data-testid":"toggle-button",onClick:m,children:[d," - ",u,"원 (재고: ",b,")"]}),n&&e.jsx("div",{className:"mt-2",children:a?e.jsx(R,{product:t,onProductUpdate:o,onCompleteEdit:r}):e.jsx(L,{product:t,onProductEdit:c})})]})},B=(t,s)=>t.find(a=>a.product.id===s.id)?t.map(a=>a.product.id===s.id?{...a,quantity:Math.min(a.quantity+1,s.stock)}:a):[...t,{product:s,quantity:1}],J=t=>{const{discounts:s}=t.product,{quantity:n}=t;let a=0;for(const o of s)n>=o.quantity&&(a=Math.max(a,o.rate));return a},W=t=>{const{discounts:s}=t.product,{quantity:n}=t;let a=0;for(const o of s)n>=o.quantity&&(a=Math.max(a,o.rate));return a},_=t=>t.reduce((s,n)=>Math.max(s,n.rate),0),z=t=>{const{price:s}=t.product,{quantity:n}=t,a=s*n,o=W(t);return a*(1-o)},G=(t,s)=>{let n=t;if(s){const{discountType:a,discountValue:o}=s;a==="amount"?n-=o:n-=+(1-(100-o)/100).toFixed(2)*n}return n},H=(t,s)=>{const n=t.reduce((c,{product:r,quantity:l})=>c+r.price*l,0),a=t.reduce((c,r)=>c+z(r),0),o=G(a,s);return{totalBeforeDiscount:n,totalAfterDiscount:o,totalDiscount:n-o}},K=(t,s,n)=>t.map(a=>{if(a.product.id===s){const o=a.product.stock,c=Math.max(0,Math.min(n,o));return c>0?{...a,quantity:c}:null}return a}).filter(a=>a!==null),U=({remainingStock:t,product:s,children:n})=>{const{id:a,name:o,price:c,discounts:r}=s;return e.jsxs("div",{"data-testid":`product-${a}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:o}),e.jsxs("span",{className:"text-gray-600",children:[c.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${t>0?"text-green-600":"text-red-600"}`,children:["재고: ",t,"개"]}),r.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(_(r)*100).toFixed(0),"% 할인"]})]}),r.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:r.map((l,i)=>e.jsxs("li",{children:[l.quantity,"개 이상: ",(l.rate*100).toFixed(0),"% 할인"]},i))}),n]})},X=({products:t,coupons:s,onProductUpdate:n,onProductAdd:a,onCouponAdd:o})=>{const[c,r]=h.useState(new Set),[l,i]=h.useState(""),[d,u]=h.useState(!1),b=x=>{r(f=>{const y=new Set(f);return y.has(x)?y.delete(x):y.add(x),y})},m=()=>{u(x=>!x)},p=x=>{n(x),i("")},N=x=>{i(x)},j=x=>{a(x),m()};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(g,{className:"px-4 py-2 mb-4",variant:"solid",color:"green",onClick:m,children:d?"취소":"새 상품 추가"}),d&&e.jsx(O,{onAddNewProduct:j}),e.jsx("div",{className:"space-y-2",children:t.map((x,f)=>e.jsx(Q,{product:x,index:f,isOpen:c.has(x.id),isEditing:l===x.id,onProductEdit:N,onCompleteEdit:p,onProductUpdate:n,onToggleButtonClick:b},`product-${x.id}-accordion`))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(M,{onCouponAdd:o}),e.jsx(E,{coupons:s})]})]})]})]})},Y=({item:t,updateQuantity:s,removeFromCart:n})=>{const{product:a,quantity:o}=t,{id:c,name:r,price:l}=a,i=J(t),d=b=>{const p=b.target.dataset.change;p&&s(c,o+Number(p))},u=()=>{n(c)};return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:r}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[l,"원 x ",o,i>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(i*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx(g,{className:"px-2 py-1 mr-1",variant:"solid",color:"gray","data-change":"-1",onClick:d,children:"-"}),e.jsx(g,{className:"px-2 py-1 mr-1",variant:"solid",color:"gray","data-change":"1",onClick:d,children:"+"}),e.jsx(g,{className:"px-2 py-1",variant:"solid",color:"red",onClick:u,children:"삭제"})]})]},t.product.id)},Z=({calculateTotal:t})=>{const{totalBeforeDiscount:s,totalAfterDiscount:n,totalDiscount:a}=t();return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",a.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",n.toLocaleString(),"원"]})]})]})},ee=({product:t,remainingStock:s,addToCart:n})=>{const a=()=>{n(t)};return e.jsx(U,{product:t,remainingStock:s,children:e.jsx(g,{className:"w-full px-3 py-1",variant:"solid",color:"blue",onClick:a,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})})},te=(t,s)=>{const n=localStorage.getItem(t);return n?JSON.parse(n):s},w=(t,s)=>{const[n,a]=h.useState(()=>te(t,s));return h.useEffect(()=>{localStorage.setItem(t,JSON.stringify(n))},[t,n]),[n,a]},se=()=>{const[t,s]=w("cart",[]),[n,a]=w("coupon",null),o=h.useCallback(d=>{s(u=>B(u,d))},[]),c=h.useCallback(d=>{s(u=>u.filter(b=>b.product.id!==d))},[]),r=h.useCallback((d,u)=>{s(b=>K(b,d,u))},[]),l=h.useCallback(d=>{a(d)},[]),i=h.useCallback(()=>H(t,n),[t,n]);return{cart:t,addToCart:o,removeFromCart:c,updateQuantity:r,applyCoupon:l,calculateTotal:i,selectedCoupon:n}},ne=t=>{const[s,n]=h.useState(t),a=h.useCallback(o=>{n(c=>[...c,o])},[]);return{coupons:s,addCoupon:a}},ae=t=>{const[s,n]=h.useState(t),a=h.useCallback(c=>{n(r=>[...r,c])},[]),o=h.useCallback(c=>{n(r=>r.map(l=>l.id===c.id?c:l))},[]);return{products:s,updateProduct:o,addProduct:a}},oe=({products:t,coupons:s})=>{const{cart:n,addToCart:a,removeFromCart:o,updateQuantity:c,applyCoupon:r,calculateTotal:l,selectedCoupon:i}=se(),d=(u,b)=>{const m=u.find(p=>p.product.id===b.id);return b.stock-((m==null?void 0:m.quantity)||0)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(u=>{const b=d(n,u);return e.jsx(ee,{remainingStock:b,product:u,addToCart:a},`cart-item-card-${u.id}`)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:n.map(u=>e.jsx(Y,{item:u,updateQuantity:c,removeFromCart:o},`cart-item-card-${u.product.id}`))}),e.jsx(T,{coupons:s,applyCoupon:r,selectedCoupon:i}),e.jsx(Z,{calculateTotal:l})]})]})]})},ce=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],re=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],le=()=>{const{products:t,updateProduct:s,addProduct:n}=ae(re),{coupons:a,addCoupon:o}=ne(ce),[c,r]=h.useState(!1),l=()=>{r(i=>!i)};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx(g,{className:"px-4 py-2",variant:"solid",color:"white",onClick:l,children:c?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:c?e.jsx(X,{products:t,coupons:a,onProductUpdate:s,onProductAdd:n,onCouponAdd:o}):e.jsx(oe,{products:t,coupons:a})})]})};q.createRoot(document.getElementById("root")).render(e.jsx(A.StrictMode,{children:e.jsx(le,{})}));
